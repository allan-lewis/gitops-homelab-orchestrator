{
  "hosts": {
    "blaine": {
      "ip": "192.168.86.98",
      "ssh_user": "lab",
      "tags": ["terraform", "arch", "devops", "canary"],

      "terraform": {
        "cpu": 2,
        "memory_mb": 2048,
        "disk_gb": 32,
        "template_ref": "arch/devops/stable",
        "node": "polaris",
        "ipconfig": "ip=192.168.86.98/24,gw=192.168.86.1"
      },

      "ansible": {
        "group_memberships": ["arch_devops", "docker_compose_monitoring"],

        "vars": {
          "ansible_environment": "staging",
          "doppler_config": "stg",
          "doppler_project": "default",
          "doppler_service_token": { "env": "DOPPLER_SERVICE_TOKEN_STAGING" },
          "terraform_environment_dir": "/home/lab/gitops-homelab/terraform/environments/staging-k8s"
        }
      }
    },
    "patricia": {
      "ip": "192.168.86.99",
      "ssh_user": "lab",
      "tags": ["terraform", "arch", "devops"],

      "terraform": {
        "cpu": 2,
        "memory_mb": 2048,
        "disk_gb": 32,
        "template_ref": "arch/devops/stable",
        "node": "polaris",
        "ipconfig": "ip=192.168.86.99/24,gw=192.168.86.1"
      },

      "ansible": {
        "group_memberships": ["arch_devops", "docker_compose_monitoring"],

        "vars": {
          "ansible_environment": "production",
          "backup_runner_cron_hour": "*",
          "backup_runner_cron_minute": "25",
          "doppler_config": "prd",
          "doppler_project": "default",
          "doppler_service_token": { "env": "DOPPLER_SERVICE_TOKEN_PRODUCTION" },
          "postgres_db_backup_enabled": true,
          "postgres_db_backup_dir": "/var/lib/postgres-db-dumps",
          "postgres_db_k8s_namespace": "authentik",
          "postgres_db_k8s_selector": "app.kubernetes.io/name=postgresql,app.kubernetes.io/component=primary",
          "postgres_db_name": "authentik",
          "postgres_db_user": "authentik",
          "postgres_db_password": "{{ lookup('env','AUTHENTIK_POSTGRESQL_PASSWORD') }}",
          "terraform_environment_dir": "/home/lab/gitops-homelab/terraform/environments/production-k8s",
          "s3_mirror_base_dir": "/var/lib/s3-mirror",
          "s3_mirror_buckets": [
            "gitops-homelab-longhorn",
            "gitops-homelab-longhorn-attic",
            "gitops-homelab-longhorn-staging",
            "gitops-homelab-terraform",
            "gitops-homelab-orchestrator-tf"
          ],
          "backup_runner_volumes": [
            { 
              "src": "{{ s3_mirror_base_dir }}",
              "dest": "{{ backup_runner_user }}@{{ backup_runner_remote_host }}:{{ backup_runner_remote_base_path }}/s3-mirror" 
            },
            { 
              "src": "{{ postgres_db_backup_dir }}",
              "dest": "{{ backup_runner_user }}@{{ backup_runner_remote_host }}:{{ backup_runner_remote_base_path }}/db-dumps" 
            }
          ]
        }
      }
    }
  },

  "ansible": {
    "all": {
      "vars": {
        "ansible_python_interpreter": "/usr/bin/python3",
        "backup_runner_user": "allan",
        "backup_runner_remote_host": "192.168.86.106"
      }
    },

    "groups": {
      "arch_devops": {
        "vars": {
          "ssh_keys_install_private_for_ansible_user": true,
          "ssh_keys_install_public_for_ansible_user": true,
          "ssh_keys_install_private_for_root": true,
          "ssh_keys_install_public_for_root": true
        }
      }
    }
  }
}
